<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“ç®¡ç†å¾Œå° - WeeklyPlan</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6', // Violet 500
                        secondary: '#EC4899', // Pink 500
                        dark: '#0F172A', // Slate 900
                        surface: '#1E293B', // Slate 800
                    }
                }
            }
        }
    </script>

    <!-- Vue.js 3 -->
    <script type="importmap">
        {
          "imports": {
            "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
            "firebase/app": "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"
          }
        }
    </script>
    
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        .modal-enter-active, .modal-leave-active { transition: opacity 0.2s ease; }
        .modal-enter-from, .modal-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-dark text-slate-200 min-h-screen font-sans">

<div id="app" class="flex flex-col min-h-screen">
    
    <!-- Header -->
    <header class="bg-surface border-b border-slate-700 shadow-lg sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                <h1 class="text-xl font-bold tracking-wide text-white">WeeklyPlan <span class="text-slate-500 font-normal">Admin</span></h1>
            </div>
            
            <a href="index.html" class="px-4 py-2 rounded-md bg-slate-700 text-white text-sm hover:bg-slate-600 transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                è¿”å›è¨ˆç®—æ©Ÿ
            </a>
        </div>
    </header>

    <!-- Content -->
    <main class="flex-grow p-4 sm:p-6 max-w-5xl mx-auto w-full">
        
        <div class="bg-surface rounded-xl border border-slate-700 p-6 shadow-xl">
            <h2 class="text-xl font-bold text-white mb-4">å•†å“èˆ‡å–®ä½è¨­å®š</h2>
            <p class="text-sm text-slate-400 mb-6">åœ¨æ­¤è¨­å®šæ‚¨å¸¸ç”¨çš„é£Ÿæåç¨±èˆ‡å–®ä½ (ä¾‹å¦‚: g, ml, é¡†, åŒ…)ã€‚è®Šæ›´å°‡å³æ™‚åŒæ­¥è‡³è¨ˆç®—æ©Ÿã€‚</p>

            <!-- Add New -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end mb-8 bg-dark/30 p-4 rounded-lg border border-slate-700">
                <div class="md:col-span-2">
                    <label class="block text-xs font-medium text-slate-400 mb-1">é£Ÿæåç¨±</label>
                    <input v-model="newProduct.name" type="text" placeholder="ä¾‹å¦‚ï¼šé›è›‹" class="w-full bg-surface border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                </div>
                <div>
                    <label class="block text-xs font-medium text-slate-400 mb-1">å–®ä½</label>
                    <input v-model="newProduct.unit" type="text" placeholder="é¡†" class="w-full bg-surface border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                </div>
                <button @click="addProduct" type="button" :disabled="!isFormValid" class="w-full bg-primary hover:bg-violet-600 disabled:opacity-50 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    <span v-if="loading">...</span>
                    <span v-else>æ–°å¢</span>
                </button>
            </div>

            <!-- Table -->
            <div class="overflow-hidden rounded-lg border border-slate-700">
                <table class="w-full text-left text-sm">
                    <thead class="bg-slate-700/50 text-slate-300 uppercase font-medium">
                        <tr>
                            <th class="px-6 py-4">åç¨±</th>
                            <th class="px-6 py-4 text-center">å–®ä½</th>
                            <th class="px-6 py-4 text-center">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700">
                        <tr v-for="product in products" :key="product.id" class="hover:bg-slate-700/30 transition-colors">
                            <td class="px-6 py-3">
                                <input v-model="product.name" @change="updateProduct(product)" class="bg-transparent border-b border-transparent focus:border-primary hover:border-slate-600 focus:outline-none w-full py-1 text-white">
                            </td>
                            <td class="px-6 py-3 text-center">
                                <input v-model="product.unit" @change="updateProduct(product)" class="bg-transparent border-b border-transparent focus:border-primary hover:border-slate-600 focus:outline-none w-16 text-center py-1 text-slate-400">
                            </td>
                            <td class="px-6 py-3 text-center">
                                <button @click="deleteProduct(product.id)" type="button" class="text-slate-500 hover:text-red-400 transition-colors">
                                    åˆªé™¤
                                </button>
                            </td>
                        </tr>
                        <tr v-if="products.length === 0">
                            <td colspan="3" class="px-6 py-8 text-center text-slate-500">
                                å°šæœªæ–°å¢ä»»ä½•å•†å“
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <!-- Alert Modal -->
    <transition name="modal">
        <div v-if="modalState.isOpen" class="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div @click="closeModal(false)" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
            <div class="bg-surface rounded-xl border border-slate-600 shadow-2xl max-w-sm w-full relative z-10 p-6">
                <h3 class="text-lg font-bold text-white mb-2">{{ modalState.type === 'alert' ? 'ğŸ”” æç¤º' : 'âš ï¸ ç¢ºèª' }}</h3>
                <p class="text-slate-300 mb-6">{{ modalState.message }}</p>
                <div class="flex justify-end gap-3">
                    <button v-if="modalState.type === 'confirm'" @click="closeModal(false)" class="px-4 py-2 rounded-lg text-slate-400 hover:text-white">å–æ¶ˆ</button>
                    <button @click="closeModal(true)" class="px-4 py-2 rounded-lg bg-primary text-white hover:bg-violet-600">ç¢ºå®š</button>
                </div>
            </div>
        </div>
    </transition>

</div>

<script type="module">
    import { createApp, ref, reactive, computed, onMounted } from 'vue';
    import { initializeApp } from 'firebase/app';
    import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, serverTimestamp } from 'firebase/firestore';

    // ==========================================
    // CONFIGURATION
    // ==========================================
    const firebaseConfig = {
        apiKey: "AIzaSyDYIbCdV49gV05_PDEHfBGpg8REOoZchgc",
        authDomain: "cost-calculator-74860.firebaseapp.com",
        projectId: "cost-calculator-74860",
        storageBucket: "cost-calculator-74860.firebasestorage.app",
        messagingSenderId: "1079472315078",
        appId: "1:1079472315078:web:e230b337dc3ec648bc15c7"
    };

    let db = null;
    if (firebaseConfig.apiKey) {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
    }

    // ==========================================
    // MAIN APP
    // ==========================================
    const app = createApp({
        setup() {
            const products = ref([]);
            const loading = ref(false);

            // --- FIRESTORE ---
            onMounted(() => {
                if (!db) return;
                onSnapshot(collection(db, "products"), (snapshot) => {
                    products.value = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort((a, b) => a.name.localeCompare(b.name));
                });
            });

            // --- PRODUCT CRUD ---
            const newProduct = reactive({ name: '', unit: '' });
            const isFormValid = computed(() => newProduct.name && newProduct.unit);
            
            const addProduct = async () => {
                if (!db || !isFormValid.value) return;
                loading.value = true;
                try {
                    await addDoc(collection(db, "products"), { name: newProduct.name, unit: newProduct.unit, createdAt: serverTimestamp() });
                    newProduct.name = ''; newProduct.unit = '';
                } catch(e) {
                    console.error(e);
                    await showAlert('æ–°å¢å¤±æ•—ï¼š' + e.message);
                }
                loading.value = false;
            };

            const updateProduct = async (p) => { 
                if(db) await updateDoc(doc(db, "products", p.id), { name: p.name, unit: p.unit }); 
            };
            
            const deleteProduct = async (id) => { 
                if(db && await showConfirm('ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤æ­¤å•†å“å—ï¼Ÿ')) {
                    await deleteDoc(doc(db, "products", id)); 
                }
            };

            // --- MODAL LOGIC ---
            const modalState = reactive({ isOpen: false, type: 'alert', message: '', resolve: null });
            const showConfirm = (message) => new Promise(r => { modalState.type='confirm'; modalState.message=message; modalState.isOpen=true; modalState.resolve=r; });
            const showAlert = (message) => new Promise(r => { modalState.type='alert'; modalState.message=message; modalState.isOpen=true; modalState.resolve=r; });
            const closeModal = (result) => { modalState.isOpen=false; if(modalState.resolve) { modalState.resolve(result); modalState.resolve=null; }};

            return {
                products, newProduct, loading, isFormValid,
                addProduct, updateProduct, deleteProduct,
                modalState, closeModal
            };
        }
    });

    app.mount('#app');
</script>

</body>
</html>